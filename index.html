<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Prototype Tape Board (Basic)</title>
    <style>
      :root {
        --bg: #f6f6f6;
        --ink: #111;
        --bar-h: 76px;
        --note-w: 160px;
        --note-h: 64px;
        --note-bg: #fff7b3; /* 심플한 메모 색 */
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--ink);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          sans-serif;
        overflow: hidden;
      }
      #board {
        position: relative;
        height: calc(100% - var(--bar-h) - 16px);
        margin: 8px;
        border-radius: 12px;
        background: #fff;
        box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.06);
        overflow: hidden;
      }
      #bar {
        position: fixed;
        left: 8px;
        right: 8px;
        bottom: 8px;
        height: var(--bar-h);
        display: flex;
        gap: 8px;
        align-items: center;
        padding: 8px;
        background: #fff;
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: 12px;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
      }
      #word {
        flex: 1;
        height: 48px;
        padding: 0 12px;
        border: 1px solid rgba(0, 0, 0, 0.18);
        border-radius: 10px;
        font-size: 16px;
        outline: none;
      }
      #add,
      #reset {
        height: 48px;
        padding: 0 14px;
        border-radius: 10px;
        border: 1px solid rgba(0, 0, 0, 0.25);
        background: #222;
        color: #fff;
        font-weight: 700;
        cursor: pointer;
      }
      #reset {
        background: #666;
      }

      /* 메모(테이프) — 아주 단순한 직사각형 */
      .note {
        position: absolute;
        width: var(--note-w);
        height: var(--note-h);
        background: var(--note-bg);
        border: 1px solid rgba(0, 0, 0, 0.15);
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.07);
        opacity: 0.5;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 8px 28px 8px 12px; /* 우측에 X 공간 */
        user-select: none;
        cursor: grab;
      }
      .note:active {
        cursor: grabbing;
      }
      .note .label {
        font-weight: 800;
        font-size: 16px;
        line-height: 1.2;
        text-align: center;
        width: 100%;
        overflow-wrap: anywhere;
      }
      .note .close {
        position: absolute;
        top: 6px;
        right: 6px;
        width: 22px;
        height: 22px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 900;
        background: #222;
        color: #fff;
        border: 1px solid rgba(0, 0, 0, 0.25);
        cursor: pointer;
        font-size: 13px;
        opacity: 0.85;
      }
      .note .close:hover {
        opacity: 1;
      }

      .toast {
        position: fixed;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        background: #111;
        color: #fff;
        padding: 8px 12px;
        border-radius: 10px;
        font-size: 13px;
        opacity: 0.95;
        z-index: 30;
      }
    </style>
  </head>
  <body>
    <main id="board" aria-label="보드"></main>

    <section id="bar" aria-label="입력">
      <input
        id="word"
        type="text"
        placeholder="단어 입력"
        autocomplete="off"
        autocapitalize="none"
        spellcheck="false"
      />
      <button id="add" type="button">완료</button>
      <button id="reset" type="button">초기화</button>
    </section>

    <script>
      (function () {
        var board = document.getElementById('board');
        var input = document.getElementById('word');
        var addBtn = document.getElementById('add');
        var resetBtn = document.getElementById('reset');
        var LS = 'tape_proto_basic_v1';

        function toast(msg) {
          var t = document.createElement('div');
          t.className = 'toast';
          t.textContent = msg;
          document.body.appendChild(t);
          setTimeout(function () {
            if (t && t.parentNode) t.parentNode.removeChild(t);
          }, 1200);
        }

        function snapshot() {
          var arr = [],
            nodes = board.querySelectorAll('.note');
          nodes.forEach(function (n) {
            arr.push({
              id: n.dataset.id,
              text: n.querySelector('.label').textContent,
              x: parseFloat(n.style.left) || 12,
              y: parseFloat(n.style.top) || 12,
            });
          });
          return { items: arr };
        }
        function save() {
          try {
            localStorage.setItem(LS, JSON.stringify(snapshot()));
          } catch (e) {}
        }
        function load() {
          try {
            var raw = localStorage.getItem(LS);
            if (!raw) return;
            var data = JSON.parse(raw);
            if (data && data.items) data.items.forEach(spawn);
          } catch (e) {}
        }

        function makeDraggable(node) {
          var sx = 0,
            sy = 0,
            ox = 0,
            oy = 0,
            dragging = false,
            pid = null;
          function move(e) {
            if (!dragging) return;
            var dx = e.clientX - sx,
              dy = e.clientY - sy;
            var rB = board.getBoundingClientRect();
            var rN = node.getBoundingClientRect();
            var left = Math.max(6, Math.min(rB.width - rN.width - 6, ox + dx));
            var top = Math.max(6, Math.min(rB.height - rN.height - 6, oy + dy));
            node.style.left = left + 'px';
            node.style.top = top + 'px';
          }
          function up() {
            if (!dragging) return;
            dragging = false;
            try {
              if (pid != null) node.releasePointerCapture(pid);
            } catch (err) {}
            window.removeEventListener('pointermove', move);
            window.removeEventListener('pointerup', up);
            save();
          }
          node.addEventListener(
            'pointerdown',
            function (e) {
              if (typeof e.button !== 'undefined' && e.button !== 0) return;
              var r = node.getBoundingClientRect(),
                b = board.getBoundingClientRect();
              sx = e.clientX;
              sy = e.clientY;
              ox = r.left - b.left;
              oy = r.top - b.top;
              pid = e.pointerId;
              dragging = true;
              try {
                if (pid != null) node.setPointerCapture(pid);
              } catch (err) {}
              window.addEventListener('pointermove', move, { passive: true });
              window.addEventListener('pointerup', up, { passive: true });
              e.preventDefault();
            },
            { passive: false }
          );
        }

        function spawn(opt) {
          opt = opt || {};
          var v = (opt.text || '').trim();
          if (!v) return null;

          var n = document.createElement('div');
          n.className = 'note';
          n.dataset.id =
            opt.id ||
            (crypto.randomUUID
              ? crypto.randomUUID()
              : String(Date.now() + Math.random()));
          n.style.left = (typeof opt.x === 'number' ? opt.x : 12) + 'px';
          n.style.top = (typeof opt.y === 'number' ? opt.y : 12) + 'px';

          var label = document.createElement('div');
          label.className = 'label';
          label.textContent = v;
          var close = document.createElement('button');
          close.className = 'close';

          n.appendChild(label);

          board.appendChild(n);
          makeDraggable(n);
          save();
          return n;
        }

        function submit() {
          var v = input.value.trim();
          if (!v) return;
          // 보드 하단 바 위에 나오도록 대략 배치
          var br = document.getElementById('bar').getBoundingClientRect();
          var b = board.getBoundingClientRect();
          spawn({
            text: v,
            x: Math.random() * (board.clientWidth - 180) + 12,
            y: Math.max(12, br.top - b.top - 100),
          });
          input.value = '';
          input.focus();
        }

        addBtn.addEventListener('click', submit);
        input.addEventListener('keydown', function (e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            submit();
          }
        });

        resetBtn.addEventListener('click', function () {
          try {
            localStorage.setItem(LS, JSON.stringify({ items: [] }));
          } catch (e) {}
          board.querySelectorAll('.note').forEach(function (n) {
            n.remove();
          });
          toast('초기화 완료');
        });

        load();
      })();
    </script>
  </body>
</html>
